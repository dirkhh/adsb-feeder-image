# Example Apache2 Virtual Host Configuration
# Add this to your existing virtual host configuration

# Enable required modules (if not already enabled)
# sudo a2enmod proxy
# sudo a2enmod proxy_http
# sudo a2enmod headers

<VirtualHost *:443>
    ServerName yourdomain.com
    DocumentRoot /var/www/html

    # SSL configuration (adjust as needed)
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key

    # Proxy webhook requests to the service
    ProxyPreserveHost On
    ProxyPass /cicd-webhook/binary-test http://127.0.0.1:9111/cicd-webhook/binary-test
    ProxyPassReverse /cicd-webhook/binary-test http://127.0.0.1:9111/cicd-webhook/binary-test

    # Optional: Add security headers and rate limiting
    <Location "/cicd-webhook/binary-test">
        # Security headers
        Header always set X-Content-Type-Options nosniff
        Header always set X-Frame-Options DENY
        Header always set X-XSS-Protection "1; mode=block"

        # Optional: Rate limiting (requires mod_evasive)
        # DOSHashTableSize    2048
        # DOSPageCount        2
        # DOSSiteCount        50
        # DOSPageInterval     1
        # DOSSiteInterval     1
        # DOSBlockingPeriod   600

        # Optional: IP restrictions (uncomment and adjust as needed)
        # Require ip 192.168.1.0/24
        # Require ip 10.0.0.0/8
    </Location>

    # Optional: Log webhook requests separately
    CustomLog ${APACHE_LOG_DIR}/webhook_access.log combined
    ErrorLog ${APACHE_LOG_DIR}/webhook_error.log

    # Your existing website configuration...
    # DocumentRoot /var/www/html
    # <Directory /var/www/html>
    #     AllowOverride All
    #     Require all granted
    # </Directory>
</VirtualHost>

# HTTP to HTTPS redirect (if using SSL)
<VirtualHost *:80>
    ServerName yourdomain.com
    Redirect permanent / https://yourdomain.com/
</VirtualHost>
