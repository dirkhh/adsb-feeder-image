<!DOCTYPE html>
<html lang="en" data-mdb-theme="auto">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Google Fonts Roboto. Copyright 2011 Google Inc. All Rights Reserved. See {{ url_for('static', filename='fonts/LICENSE.txt') }} -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}" />
  <!-- MDB -->
  <link rel="stylesheet" id="css-theme" href="{{ url_for('static', filename='css/mdb.min.css') }}" />
  <script>
    ; (function () {
      const htmlElement = document.querySelector("html")
      if (htmlElement.getAttribute("data-mdb-theme") === 'auto') {
        function updateTheme() {
          document.querySelector("html").setAttribute("data-mdb-theme",
            window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light")
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme)
        updateTheme()
      }
    })()
  </script>
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" />
  <!-- Spinner -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <title>
    ADS-B Feeder Image Hotspot
  </title>
</head>

<body>
  <div id="loader" style="display: none"></div>
  <div id="overlay" style="display: none">
    <div id="overlaytext">
      please wait
      <br />
      this could take several minutes
    </div>
  </div>
  <div class="container pt-5 mt-3">
    <h1 class="mt-5">WiFi Setup</h1>
    {% if comment == "" %}
    <div class="mt-3">The ADS-B Feeder Image wasn't able to connect to a network. Please enter an SSID and password so
      that we can connect to the network and continue the setup.</div>
    {% else %}
    <div class="mt-3">{{ comment }}</div>
    {% endif %}
    {% if not comment.startswith("Success") %}
    <form method="post">
      <div class="row mt-4">
        <div class="col-md-6 mb-3">
          <label for="ssidinput" class="form-label">SSID</label>
          <div class="dropdown">
            <input class="form-control wifi-ssid-input" id="ssidinput" name="ssid" type="text" placeholder="Pick or enter SSID" required
                   autocomplete="off" onclick="showHotspotWifiDropdown()">
            <ul class="dropdown-menu w-100" id="hotspot_wifi_dropdown" style="max-height: 200px; overflow-y: auto;">
              {% for ssid in ssids %}
              <li><a class="dropdown-item" href="#" onclick="selectHotspotSsid('{{ ssid }}')">{{ ssid }}</a></li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label for="passwd" class="form-label">Password</label>
          <input type="password" id="passwd" name="passwd" placeholder="Password" class="form-control" />
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <button type="submit" name="submit" value="go" class="btn btn-primary btn-lg">Configure</button>
        </div>
      </div>
    </form>
    <div class="mt-4">
      Once you click the <strong>Configure</strong> button, the Hotspot connection will drop and the feeder will attempt
      to connect to the network that you specified. If that WiFi connection is successful, the feeder should become
      available on that WiFi network as <code>adsb-feeder.local</code>. If the connection fails, the feeder will once
      again bring up this hotspot and you can try entering the credentials again.
    </div>
    {% endif %}
    
    <footer class="mt-5 py-4">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-auto">
            <div class="text-muted text-center">
              <small>
                Running <a href="https://adsb.im/home" class="text-decoration-none">ADS-B Feeder Image</a> {{ version }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>
  <script type="text/javascript" src="{{ url_for('static', filename='js/mdb.min.js') }}"></script>
  <script>
    function showHotspotWifiDropdown() {
      const dropdown = document.getElementById('hotspot_wifi_dropdown');
      dropdown.classList.add('show');
    }

    function selectHotspotSsid(ssid) {
      document.getElementById('ssidinput').value = ssid;
      document.getElementById('hotspot_wifi_dropdown').classList.remove('show');
    }

    document.addEventListener('DOMContentLoaded', function() {
      const wifiSsidInput = document.getElementById('ssidinput');
      const dropdown = document.getElementById('hotspot_wifi_dropdown');

      if (wifiSsidInput && dropdown) {
        document.addEventListener('click', function(event) {
          if (!wifiSsidInput.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.remove('show');
          }
        });
      }
    });
  </script>
</body>

</html>
